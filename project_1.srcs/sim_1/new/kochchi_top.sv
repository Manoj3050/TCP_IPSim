////-─────────╒──────────────────────────────────────────────────────────────────────
////-────────┌░──────────────────────────────────────────────────────────────────────
////-───────┌╠──────────────────────┌┌───╔───────────┌╔╔░╠╠╠╠╠╠░╔╔╓┌─────────────────
////-───────│╠───────────────┌╔╔╔───╠╠░┐┌╠╠░───┌╓──╔╠╠╠╙╙╠╠╠└╠╠└╠╠╚╠╠░╔┌─────────────
////-───────╠╠───────┌┌┌──────┌│╠╠╔░╠╠╠╠╠╠╠╠╠╠╠╠──╠╠╠╙─┌┌──└──└┌╠┘─└╚╠╠╙╚░╔┌──╔░░────
////-──────┌╠╠───────╠╠╠╓╔╔░╠╠╚└┐└╠╠└╙╠╠└╓╓┌╓║░───╠╠╠╔╠╠╠─┌───────────└└──└└╙╒╠╠╙────
////-──────╠╠╠────────╘╠╠╚╠╠╠╠░╙─╠╔╓╒└╔╔╔╔╠─┐╙╠░─┌╠╠╠╠╠╠╠┐│░╓───────┌┌┌┌┌┌┌──────────
////-──────╠╠╠────────────└╠╠░╚░░╠╙╠─└╠┌└┘╓─╠░╓└─╠╠╙└└╠╠╠╠╠╠╠╠░╔░░╠╠╠╠╠╠╚╚╚╠╠░░╔┌────
////-─────┌╠╠╠───────┌╓┌┌┌┌┌┌┌┌┌╚╠░╓└└╔│└░╠└╠╠╠──╠──────└└╙╙╚╚╚╚╚╚╙╙└└───────╘╠╠╠░┐──
////-─────│╠╠╠───────╒╓░│││░└╠╠╠░─╠╚╠░└╚──╠╒└╠└───────────────────────────────│╠╠╠╠──
////-─────│╠╠╠────────╠╠╠╠╠╠╔╔░░╔╓╠░──╠░╔╠╔╠░└────────────────────┌┌┌╓╓╓╓┌────┌╠╠╠╠──
////-─────╠╠╠╠───────┌╠╚└╠─╠╚┌╠└╙╠╚╠░╔╠╠╙╠╠└╠░╔────────┌┌┌╓╔╔╔░╠╠╠╠╠╠╠╠╠╠╠╠░╔╔├╠╠╠───
////-─────╠╠╠╠──────────┌──└─└──┌╠─└─╠╓╘─└╠─└╠╠╒╔░░╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠┌───
////-────┌╠╠╠╠───────────────┌╔░╠╠░░╓╠╠░┐─┌└│╔╓╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠░┐─
////-┌╔╔─┌╠╠╠╠─┌┌─────────┌╔╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠─
////-└╠╠╓└╙┘┘└┌╠╠───────╓░╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠─
////-──┌└└└└└└└──┌─────╔╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠░─
////-──└╙╙╙╙╙╙└─│╠╠░──╒╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠──
////-──└╙╙╙╙╙╙└─╠╠╠╠╠─╚╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠───
////-───└╙╙╙╠░╓─╠╠╠╠╠╠─╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠░╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╙┘││╙╙╠╠╠╠╠╠╠╠╠╠╠╠╠╠────
////-──╓░└└└└─┌┌─╠╠╠╠╠╠┐╚╠╠╠╠╠└╠╠╠╠╠╠╠╠╠╠╠╠╠░╠╠╠╠╠╠╠╠╠╠╠╠╙╓╔░╠╠╠╠╠╠┐╘╠╠╠╠╠╠╠╠╠╠╠─────
////-─└╠╠░░╠╠░╠╚─╠╠╠╠╠╠╠░└╠╠╠╠┌╠╠╠╠╠╠╠╠╠╠╠╠┌╠╠╠╠╠╠╠╠╠╚╙─╓╠╠╠╠╠╠╠╠╠╠╠──└╠╠╠╠╠╠╠╠╠─────
////-─────╔╠╠───└└┘─╙╠╠╠╠╠╓└╙╠─╠╠╠╠╠╠╠╠╠╠╙╔╠╠╠╠╠╠╚╙└────└╠╠╠╠╠╠╠╠╠╠░────└╠╠╠╠╠╠░─────
////-─┌░░─└╠╠─┌░╔─────╙╠╠╠╚────└╠╠╠╠╠╠╠╚╓╠╠╠╚╙└──────────└╠╠╠╠╠╠╠╠╠───────╠╠╠╠╠╠┐────
////-─└└╚═╚╠╚╚═╚╙───────────────╠╠╠╠╠╠╠────────────────────└╠╠╠╠╠╠░╓╔╔────│╠╠╠╠╠╠╠░░─
////-────┌╔╠░╔──────────────────╠╠╠╠╠╠─┌┌╔╔─────────────────└╠╠╠╠╠╠╙└─────│╠╠╠╠╠░└───
////-──────╙────────────────────╠╠╠╠╠╠╠╠╚╙──────────────────│╠╠╠╠╠╠───────│╠╠╠╠╠╠────
////-─────────────────────────┌╔╠╠╠╠╠╠╠─────────────────────╠╠╠╠╠╠─┌╔╔╔╓┌┌╠╠╠╠╠╠╠────
////-────────────────────╔╠╠╚╠╠╙╠╠╠╠╠╠╠╔─────────────┌░╠┘╠░╒╠╠╠╠╠░┌╠╠╠╠╠╚╠╠╠╠╠╠╠╠────
////-────────────────────╚╙─╙└─╘╚╚╚╚╚╚╚└─────────────╙└─└╙─╙╙╙╙╙╙─╙╙└╚┘└╚╚╠╠└└╙┘╙────
//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 06/30/2020 03:34:41 PM
// Design Name: 
// Module Name: eth_wrapper
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////


`timescale 1fs/1fs

(* DowngradeIPIdentifiedWarnings="yes" *)
module kochchi_top
(
    input   [1:0]       gt_rxp_in,
    input   [1:0]       gt_rxn_in,
    output  [1:0]       gt_txp_out,
    output  [1:0]       gt_txn_out,
    
    //input               sys_resetn,
    input               gt_refclk_p,
    input               gt_refclk_n,
    input               sys_clk_p,
    input               sys_clk_n,
    output  [1:0]       FS,
    output              qsfp1_rstn,
    input               mod_present1,
    output              qsfp1_lpmode,
    output              qsfp1_modselL,

    input 	[15:0]      pci_express_x16_rxn,
    input 	[15:0]      pci_express_x16_rxp,
    output 	[15:0]      pci_express_x16_txn,
    output 	[15:0]      pci_express_x16_txp,
    input              	pcie_perstn,
    input              	pcie_refclk_clk_n,
    input              	pcie_refclk_clk_p
    
);

   
	wire 				user_rst;
	wire 				dclk;
	wire 				sys_reset;
	
	////    ethernet clocks
	wire 				rx_clk_out_0;
	wire 				tx_clk_out_0;
	wire 				rx_clk_out_1;
	wire 				tx_clk_out_1;
	 
	//// RX_0 User Interface Signals
	wire 				rx_axis_tvalid_0;
	wire 	[63:0] 		rx_axis_tdata_0;
	wire 				rx_axis_tlast_0;
	wire 	[7:0] 		rx_axis_tkeep_0;
	wire 				rx_axis_tuser_0; 
	
	//// TX_0 User Interface Signals
	wire 				tx_axis_tready_0;
	wire 				tx_axis_tvalid_0;
	wire 	[63:0] 		tx_axis_tdata_0;
	wire 				tx_axis_tlast_0;
	wire 	[7:0] 		tx_axis_tkeep_0;
	wire 				tx_axis_tuser_0;

//// RX_1 User Interface Signals
(* mark_debug ="true" *)  wire 				rx_axis_tvalid_1;
(* mark_debug ="true" *)  wire [63:0] 		rx_axis_tdata_1;
(* mark_debug ="true" *)  wire 				rx_axis_tlast_1;
(* mark_debug ="true" *)  wire [7:0] 		rx_axis_tkeep_1;
(* mark_debug ="true" *)  wire 				rx_axis_tuser_1;
  
//// TX_1 User Interface Signals
(* mark_debug ="true" *)  wire 				tx_axis_tready_1;
(* mark_debug ="true" *)  wire 				tx_axis_tvalid_1;
(* mark_debug ="true" *)  wire [63:0] 		tx_axis_tdata_1;
(* mark_debug ="true" *)  wire 				tx_axis_tlast_1;
(* mark_debug ="true" *)  wire [7:0] 		tx_axis_tkeep_1;
(* mark_debug ="true" *)  wire 				tx_axis_tuser_1;

//// RX_sw Interface Signals
(* mark_debug ="true" *)  wire 				rx_axis_tvalid;
(* mark_debug ="true" *)  wire [63:0] 		rx_axis_tdata;
(* mark_debug ="true" *)  wire 				rx_axis_tlast;
(* mark_debug ="true" *)  wire [7:0] 		rx_axis_tkeep;
(* mark_debug ="true" *)  wire 				rx_axis_tuser;
  
//// TX_swInterface Signals
(* mark_debug ="true" *)  wire 				tx_axis_tready;
(* mark_debug ="true" *)  wire 				tx_axis_tvalid;
(* mark_debug ="true" *)  wire [63:0] 		tx_axis_tdata;
(* mark_debug ="true" *)  wire 				tx_axis_tlast;
(* mark_debug ="true" *)  wire [7:0] 		tx_axis_tkeep;
(* mark_debug ="true" *)  wire 				tx_axis_tuser;

	//// ethernet core status signals
	wire 				tat_rx_status_0;         
	wire 				tat_rx_block_lock_0;     
	wire 				tat_rx_status_1;         
	wire 				tat_rx_block_lock_1;     
	wire 				tat_rx_bad_code_0;       
	wire 				tat_rx_valid_ctrl_code_0;
	wire 				tat_rx_bad_code_1;       
	wire 				tat_rx_valid_ctrl_code_1;
	wire 				tat_tx_local_fault_0;    
	wire 				tat_tx_local_fault_1;    
	wire 				tat_rx_local_fault_0;    
	wire 				tat_rx_local_fault_1;    
	wire 				tat_rx_remote_fault_0;   
	wire 				tat_rx_remote_fault_1; 
		
	wire 				ser_rx_reset_0  ; 
	wire 				ser_rx_reset_1  ;
	wire 				ser_tx_reset_0  ;
	wire 				ser_tx_reset_1  ;

	wire 	[63:0]		M_AXIS_0_tdata;
  	wire 	[7:0]		M_AXIS_0_tkeep;
  	wire 				M_AXIS_0_tlast;
  	wire 				M_AXIS_0_tready;
  	wire 				M_AXIS_0_tvalid;
  	wire 	[31:0]		M_AXI_LITE_0_araddr;
  	wire 	[2:0]		M_AXI_LITE_0_arprot;
  	reg 				M_AXI_LITE_0_arready;
  	wire 	 			M_AXI_LITE_0_arvalid;
  	wire 	[31:0]		M_AXI_LITE_0_awaddr;
  	wire 	[2:0]		M_AXI_LITE_0_awprot;
  	wire 				M_AXI_LITE_0_awready;
  	wire 				M_AXI_LITE_0_awvalid;
  	wire 				M_AXI_LITE_0_bready;
  	wire 	[1:0]		M_AXI_LITE_0_bresp;
  	wire 				M_AXI_LITE_0_bvalid;
  	reg  	[31:0]		M_AXI_LITE_0_rdata;
  	wire 				M_AXI_LITE_0_rready;
  	wire 	[1:0]		M_AXI_LITE_0_rresp;
  	reg  				M_AXI_LITE_0_rvalid;
  	wire 	[31:0]		M_AXI_LITE_0_wdata;
  	wire 				M_AXI_LITE_0_wready;
  	wire 	[3:0]		M_AXI_LITE_0_wstrb;
  	wire 				M_AXI_LITE_0_wvalid;
  	wire 	[63:0]		S_AXIS_0_tdata;
  	wire 	[7:0]		S_AXIS_0_tkeep;
  	wire 				S_AXIS_0_tready;
  	wire 				S_AXIS_0_tvalid;
  	wire 				S_AXIS_0_tlast;
  	wire 				axi_aclk;
  	wire 				axi_aresetn;
  	wire 				chnl_sw;
  	wire 				rx_clk;
  	wire 				tx_clk;
  		
  	reg 				rx_rst_0;
  	reg 				rx_rst_1;
  	reg 				axi_rst;
  		
  	reg 				rx_rst1_0;
  	reg 				rx_rst1_1;
  	reg 				axi_rst1;
  	reg 				rx_rst2_0;
  	reg 				rx_rst2_1;
  	reg 				axi_rst2;
  
    reg 	[11:0] 		wordcount;
    wire 	[11:0] 		wordcount_fout;
    wire 	[11:0] 		wordcount_fin;
    wire 				wordcount_fout_valid;
    wire 				rx_count_wren;
    wire 				sw_rst;
 
assign sys_reset = user_rst | (~axi_aresetn);

////// RX_sw Interface Signals
// assign rx_axis_tvalid = chnl_sw?  rx_axis_tvalid_0 : rx_axis_tvalid_1;      
// assign rx_axis_tdata  = chnl_sw?  rx_axis_tdata_0 : rx_axis_tdata_1;
// assign rx_axis_tlast  = chnl_sw?  rx_axis_tlast_0 : rx_axis_tlast_1;       
// assign rx_axis_tkeep  = chnl_sw?  rx_axis_tkeep_0 : rx_axis_tkeep_1; 
// assign rx_axis_tuser  = chnl_sw?  rx_axis_tuser_0 : rx_axis_tuser_1;       
  
////// TX_swInterface Signals
//assign  tx_axis_tready = chnl_sw? tx_axis_tready_0 : tx_axis_tready_1;
//assign  tx_axis_tvalid_0 = tx_axis_tvalid & chnl_sw;
//assign  tx_axis_tvalid_1 = tx_axis_tvalid & (~chnl_sw);

//assign  tx_axis_tdata_0 = tx_axis_tdata;
//assign  tx_axis_tlast_0 = tx_axis_tlast;
//assign  tx_axis_tkeep_0 = tx_axis_tkeep;
//assign  tx_axis_tuser_0 = tx_axis_tuser;

//assign  tx_axis_tdata_1 = tx_axis_tdata;
//assign  tx_axis_tlast_1 = tx_axis_tlast;
//assign  tx_axis_tkeep_1 = tx_axis_tkeep;
//assign  tx_axis_tuser_1 = tx_axis_tuser;

//assign rx_clk = chnl_sw? rx_clk_out_0 : rx_clk_out_1;
//assign tx_clk = chnl_sw? tx_clk_out_0 : tx_clk_out_1;


always @(posedge axi_aclk) begin
    axi_rst1 	<= user_rst | (~axi_aresetn);
    axi_rst2 	<= axi_rst1;
    axi_rst 	<= axi_rst2;
end


eth_wrapper eth_wrapper_inst(
    .sys_reset                  (sys_reset              ),
    .sw_rst                     (sw_rst                 ),
    .gt_refclk_p                (gt_refclk_p            ),
    .gt_refclk_n                (gt_refclk_n            ),
    .dclk                       (dclk                   ),
    .pcie_clk                   (axi_aclk               ),
    
    .gt_rxp_in                  (gt_rxp_in              ),
    .gt_rxn_in                  (gt_rxn_in              ),
    .gt_txp_out                 (gt_txp_out             ),
    .gt_txn_out                 (gt_txn_out             ),
    
    .chnl_sw                    (chnl_sw                ),
    
    .rx_axis_tvalid           	(S_AXIS_0_tvalid       ),
    .rx_axis_tdata            	(S_AXIS_0_tdata        ),
    .rx_axis_tlast            	(S_AXIS_0_tlast        ),
    .rx_axis_tkeep            	(S_AXIS_0_tkeep        ),
    .rx_axis_tuser            	(        ),
    
    .rx_word_count              (wordcount_fout), 
    .pop_rx_count               (M_AXI_LITE_0_rvalid & M_AXI_LITE_0_rready & wordcount_fout_valid),       
    .rx_word_count_valid        (wordcount_fout_valid),
    
//    .rx_axis_tvalid_1           (rx_axis_tvalid_1       ),    
//    .rx_axis_tdata_1            (rx_axis_tdata_1        ),
//    .rx_axis_tlast_1            (rx_axis_tlast_1        ),
//    .rx_axis_tkeep_1            (rx_axis_tkeep_1        ),
//    .rx_axis_tuser_1            (rx_axis_tuser_1        ),
    
    .tx_axis_tready           	(M_AXIS_0_tready       ),
    .tx_axis_tvalid           	(M_AXIS_0_tvalid       ),
    .tx_axis_tdata            	(M_AXIS_0_tdata        ),
    .tx_axis_tlast            	(M_AXIS_0_tlast        ),
    .tx_axis_tkeep            	(M_AXIS_0_tkeep        ),
    .tx_axis_tuser            	(1'b0        ),
    
//    .tx_axis_tready_1           (tx_axis_tready_1       ),
//    .tx_axis_tvalid_1           (tx_axis_tvalid_1       ),
//    .tx_axis_tdata_1            (tx_axis_tdata_1        ),
//    .tx_axis_tlast_1            (tx_axis_tlast_1        ),
//    .tx_axis_tkeep_1            (tx_axis_tkeep_1        ),
//    .tx_axis_tuser_1            (tx_axis_tuser_1        ),
    
//    .rx_clk_out_0               (rx_clk_out_0           ),
//    .tx_clk_out_0               (tx_clk_out_0           ),
//    .rx_clk_out_1               (rx_clk_out_1           ),
//    .tx_clk_out_1               (tx_clk_out_1           ),

//    .user_rx_reset_0            (user_rx_reset_0),
//    .user_rx_reset_1            (user_rx_reset_1),
//    .user_tx_reset_0            (user_tx_reset_0),
//    .user_tx_reset_1            (user_tx_reset_1),

    
    .stat_rx_status_0           (stat_rx_status_0         ),
    .stat_rx_block_lock_0       (stat_rx_block_lock_0     ),
    .stat_rx_status_1           (stat_rx_status_1         ),
    .stat_rx_block_lock_1       (stat_rx_block_lock_1     ),
    .stat_rx_bad_code_0         (stat_rx_bad_code_0       ),
    .stat_rx_valid_ctrl_code_0  (stat_rx_valid_ctrl_code_0),
    .stat_rx_bad_code_1         (stat_rx_bad_code_1       ),
    .stat_rx_valid_ctrl_code_1  (stat_rx_valid_ctrl_code_1),
    .stat_tx_local_fault_0      (stat_tx_local_fault_0    ),
    .stat_tx_local_fault_1      (stat_tx_local_fault_1    ),
    .stat_rx_local_fault_0      (stat_rx_local_fault_0    ),
    .stat_rx_local_fault_1      (stat_rx_local_fault_1    ),
    .stat_rx_remote_fault_0     (stat_rx_remote_fault_0   ),
    .stat_rx_remote_fault_1     (stat_rx_remote_fault_1   ),
    
    .FS                         (FS                     ),
    .qsfp1_rstn                 (qsfp1_rstn             ),
    .mod_present1               (mod_present1           ),
    .qsfp1_lpmode               (qsfp1_lpmode           ),
    .qsfp1_modselL              (qsfp1_modselL          )
    
    
    );
/*
    axis_data_fifo tx_fifo (
      .s_axis_aresetn(~sys_reset),          // input wire s_axis_aresetn
      .m_axis_aresetn(~sys_reset),          // input wire m_axis_aresetn
      
      .s_axis_aclk(axi_aclk),                // input wire s_axis_aclk
      .s_axis_tvalid(M_AXIS_0_tvalid),            // input wire s_axis_tvalid
      .s_axis_tready(M_AXIS_0_tready),            // output wire s_axis_tready
      .s_axis_tdata(M_AXIS_0_tdata),              // input wire [63 : 0] s_axis_tdata
      .s_axis_tkeep(M_AXIS_0_tkeep),              // input wire [7 : 0] s_axis_tkeep
      .s_axis_tlast(M_AXIS_0_tlast),              // input wire s_axis_tlast
      .s_axis_tuser('h0),              // input wire [0 : 0] s_axis_tuser
      
      .m_axis_aclk(tx_clk),                // input wire m_axis_aclk
      .m_axis_tvalid(tx_axis_tvalid),            // output wire m_axis_tvalid
      .m_axis_tready(tx_axis_tready),            // input wire m_axis_tready
      .m_axis_tdata(tx_axis_tdata),              // output wire [63 : 0] m_axis_tdata
      .m_axis_tkeep(tx_axis_tkeep),              // output wire [7 : 0] m_axis_tkeep
      .m_axis_tlast(tx_axis_tlast),              // output wire m_axis_tlast
      .m_axis_tuser(tx_axis_tuser),              // output wire [0 : 0] m_axis_tuser

      
      .axis_data_count(),        // output wire [31 : 0] axis_data_count
      .axis_wr_data_count(),  // output wire [31 : 0] axis_wr_data_count
      .axis_rd_data_count()  // output wire [31 : 0] axis_rd_data_count
    );
   
    axis_data_fifo rx_fifo (
      .s_axis_aresetn(~sys_reset),          // input wire s_axis_aresetn
      .m_axis_aresetn(~sys_reset),          // input wire m_axis_aresetn
      
      .s_axis_aclk(rx_clk),                // input wire s_axis_aclk
      .s_axis_tvalid(rx_axis_tvalid),            // input wire s_axis_tvalid
      .s_axis_tready(),            // output wire s_axis_tready
      .s_axis_tdata(rx_axis_tdata),              // input wire [63 : 0] s_axis_tdata
      .s_axis_tkeep(rx_axis_tkeep),              // input wire [7 : 0] s_axis_tkeep
      .s_axis_tlast(rx_axis_tlast),              // input wire s_axis_tlast
      .s_axis_tuser(rx_axis_tuser),              // input wire [0 : 0] s_axis_tuser
      
      // .m_axis_aclk(tx_clk_out_1),                // input wire m_axis_aclk
      // .m_axis_tvalid(tx_axis_tvalid_1),            // output wire m_axis_tvalid
      // .m_axis_tready(tx_axis_tready_1),            // input wire m_axis_tready
      // .m_axis_tdata(tx_axis_tdata_1),              // output wire [63 : 0] m_axis_tdata
      // .m_axis_tkeep(tx_axis_tkeep_1),              // output wire [7 : 0] m_axis_tkeep
      // .m_axis_tlast(tx_axis_tlast_1),              // output wire m_axis_tlast
      // .m_axis_tuser(tx_axis_tuser_1),              // output wire [0 : 0] m_axis_tuser

      .m_axis_aclk  (axi_aclk),                // input wire m_axis_aclk
      .m_axis_tvalid(S_AXIS_0_tvalid),            // output wire m_axis_tvalid
      .m_axis_tready(S_AXIS_0_tready),            // input wire m_axis_tready
      .m_axis_tdata(S_AXIS_0_tdata),              // output wire [63 : 0] m_axis_tdata
      .m_axis_tkeep(S_AXIS_0_tkeep),              // output wire [7 : 0] m_axis_tkeep
      .m_axis_tlast(S_AXIS_0_tlast),              // output wire m_axis_tlast
      .m_axis_tuser(),              // output wire [0 : 0] m_axis_tuser
      
      .axis_data_count(),        // output wire [31 : 0] axis_data_count
      .axis_wr_data_count(),  // output wire [31 : 0] axis_wr_data_count
      .axis_rd_data_count()  // output wire [31 : 0] axis_rd_data_count
    );
    */
   
    
//    reg [11:0] wordcount;
//    wire [11:0] wordcount_fout;
//    wire [11:0] wordcount_fin;
//    wire wordcount_fout_valid;
//    wire rx_count_wren;
    
//    reg [3:0] keep_bcount;
    
//    always_comb begin
//        case (rx_axis_tkeep_0)
//            8'h01: keep_bcount =  4'd1;
//            8'h03: keep_bcount =  4'd2;
//            8'h07: keep_bcount =  4'd3;
//            8'h0f: keep_bcount =  4'd4;
//            8'h1f: keep_bcount =  4'd5;
//            8'h3f: keep_bcount =  4'd6;
//            8'h7f: keep_bcount =  4'd7;
//            8'hff: keep_bcount =  4'd8;
//            default :  keep_bcount =  4'd0 ;
//        endcase
//    end

//    always @(posedge rx_clk) begin
//      if (rx_rst_0) begin
//        wordcount <= 'h0;
//      end
//      else begin
//        if(rx_axis_tvalid) wordcount <= wordcount + keep_bcount;
//        if(rx_axis_tlast & rx_axis_tvalid) wordcount <=  8'h0;
//      end
//    end
    
//  assign rx_count_wren = rx_axis_tlast & rx_axis_tvalid;
//  assign wordcount_fin = wordcount + keep_bcount;
  
//   xpm_fifo_async #(
//      .CDC_SYNC_STAGES(2),       // DECIMAL
//      .DOUT_RESET_VALUE("0"),    // String
//      .ECC_MODE("no_ecc"),       // String
//      .FIFO_MEMORY_TYPE("auto"), // String
//      .FIFO_READ_LATENCY(1),     // DECIMAL
//      .FIFO_WRITE_DEPTH(2048),   // DECIMAL
//      .FULL_RESET_VALUE(0),      // DECIMAL
//      .PROG_EMPTY_THRESH(10),    // DECIMAL
//      .PROG_FULL_THRESH(10),     // DECIMAL
//      .RD_DATA_COUNT_WIDTH(1),   // DECIMAL
//      .READ_DATA_WIDTH(12),      // DECIMAL
//      .READ_MODE("fwft"),         // String
//      .RELATED_CLOCKS(0),        // DECIMAL
//      .USE_ADV_FEATURES("1707"), // String
//      .WAKEUP_TIME(0),           // DECIMAL
//      .WRITE_DATA_WIDTH(12),     // DECIMAL
//      .WR_DATA_COUNT_WIDTH(1)    // DECIMAL
//   )
//   xpm_fifo_async_inst_countl0 (
//      .almost_empty(),   
//      .almost_full(),     
//      .dbiterr(),             
//      .empty(),                 
//      .full(),                   
//      .overflow(),           
//      .prog_empty(),       
//      .prog_full(),         
//      .rd_data_count(), 
//      .rd_rst_busy(),     
//      .sbiterr(),             
//      .underflow(),         
//      .wr_ack(),               
//      .wr_data_count(), 
//      .wr_rst_busy(),  

//      .data_valid(wordcount_fout_valid),       
//      .dout(wordcount_fout),                   
//      .rd_clk(axi_aclk),
//      .rd_en((M_AXI_LITE_0_rvalid & M_AXI_LITE_0_rready & wordcount_fout_valid)),
      
//      .din(wordcount_fin),                     
//      .injectdbiterr('h0), 
//      .injectsbiterr('h0), 
//      .rst(rx_rst_0),    
//      .sleep('h0),
//      .wr_clk(rx_clk_out_0),
//      .wr_en(rx_count_wren) 

//   );


vio_0 vio_inst (
      .clk(dclk),                // input wire clk
      .probe_out0(user_rst), 
      .probe_out1(chnl_sw),//restart_tx_rx_0),
      .probe_out2(),   // input wire [0 : 0] probe_in0
      .probe_out3(sw_rst),
      .probe_in0(stat_rx_status_0),  // output wire [0 : 0] probe_out0
      .probe_in1(stat_rx_block_lock_0),  // output wire [0 : 0] probe_out1
      .probe_in2(stat_rx_status_1),  // output wire [0 : 0] probe_out2
      .probe_in3(stat_rx_block_lock_1),
      .probe_in4(stat_rx_bad_code_0),
      .probe_in5(stat_rx_valid_ctrl_code_0),       
      .probe_in6(stat_rx_bad_code_1),
      .probe_in7(stat_rx_valid_ctrl_code_1),
      .probe_in8(stat_tx_local_fault_0),             
      .probe_in9(stat_tx_local_fault_1),
      .probe_in10(stat_rx_local_fault_0),
      .probe_in11(stat_rx_local_fault_1),
      .probe_in12(stat_rx_remote_fault_0),
      .probe_in13(stat_rx_remote_fault_1),
      .probe_in14(stat_tx_local_fault_0),
      .probe_in15(stat_tx_local_fault_1)
            
    );
    
    clk_wiz_0 clk_wiz_dclk
          (
           // Clock out ports
           .clk_out1(dclk),     // output clk_out1
           // Status and control signals
           //.reset(reset), // input reset
           //.locked(),       // output locked
          // Clock in ports
           .clk_in1_p(sys_clk_p),    // input clk_in1_p
           .clk_in1_n(sys_clk_n));    // input clk_in1_n


  always@(posedge axi_aclk) begin
    if(axi_rst) begin
      M_AXI_LITE_0_arready  <= 1'b0;
      M_AXI_LITE_0_rvalid   <= 1'b1;
      M_AXI_LITE_0_rdata    <= 'h0;
    end
    else begin
      if(M_AXI_LITE_0_arvalid) begin
        M_AXI_LITE_0_arready  <= 1'b1;
      end
      else begin
        M_AXI_LITE_0_arready  <= 1'b0;
      end

      if(M_AXI_LITE_0_arvalid && M_AXI_LITE_0_arready) begin
        M_AXI_LITE_0_rvalid   <= 1'b1;
        if(wordcount_fout_valid) begin
          M_AXI_LITE_0_rdata  <= wordcount_fout;
        end
        else begin
          M_AXI_LITE_0_rdata  <= 'h0;
        end
      end
      else begin
        M_AXI_LITE_0_rvalid   <= 1'b0;
      end
    end
  end

  /* DMA subsystem */
  design_1_wrapper
  u_dma_wrapper
   (
    .M_AXIS_0_tdata               (M_AXIS_0_tdata),
    .M_AXIS_0_tkeep               (M_AXIS_0_tkeep),
    .M_AXIS_0_tlast               (M_AXIS_0_tlast),
    .M_AXIS_0_tready              (M_AXIS_0_tready),
    .M_AXIS_0_tvalid              (M_AXIS_0_tvalid),

    .M_AXI_LITE_0_araddr          (M_AXI_LITE_0_araddr),
    .M_AXI_LITE_0_arprot          (M_AXI_LITE_0_arprot),
    .M_AXI_LITE_0_arready         (M_AXI_LITE_0_arready),
    .M_AXI_LITE_0_arvalid         (M_AXI_LITE_0_arvalid),
    .M_AXI_LITE_0_awaddr          (M_AXI_LITE_0_awaddr),
    .M_AXI_LITE_0_awprot          (M_AXI_LITE_0_awprot),
    .M_AXI_LITE_0_awready         (M_AXI_LITE_0_awready),
    .M_AXI_LITE_0_awvalid         (M_AXI_LITE_0_awvalid),
    .M_AXI_LITE_0_bready          (M_AXI_LITE_0_bready),
    .M_AXI_LITE_0_bresp           (M_AXI_LITE_0_bresp),
    .M_AXI_LITE_0_bvalid          (M_AXI_LITE_0_bvalid),
    .M_AXI_LITE_0_rdata           (M_AXI_LITE_0_rdata),//M_AXI_LITE_0_rdata),
    .M_AXI_LITE_0_rready          (M_AXI_LITE_0_rready),
    .M_AXI_LITE_0_rresp           ('h0),//M_AXI_LITE_0_rresp),
    .M_AXI_LITE_0_rvalid          (M_AXI_LITE_0_rvalid),
    .M_AXI_LITE_0_wdata           (M_AXI_LITE_0_wdata),
    .M_AXI_LITE_0_wready          (M_AXI_LITE_0_wready),
    .M_AXI_LITE_0_wstrb           (M_AXI_LITE_0_wstrb),
    .M_AXI_LITE_0_wvalid          (M_AXI_LITE_0_wvalid),

    .S_AXIS_0_tdata               (S_AXIS_0_tdata),
    .S_AXIS_0_tkeep               (S_AXIS_0_tkeep),
    .S_AXIS_0_tready              (S_AXIS_0_tready),
    .S_AXIS_0_tvalid              (S_AXIS_0_tvalid),
    .S_AXIS_0_tlast               (S_AXIS_0_tlast),

    .axi_aclk                     (axi_aclk),
    .axi_aresetn                  (axi_aresetn),
    
    .pci_express_x16_rxn          (pci_express_x16_rxn),
    .pci_express_x16_rxp          (pci_express_x16_rxp),
    .pci_express_x16_txn          (pci_express_x16_txn),
    .pci_express_x16_txp          (pci_express_x16_txp),
    .pcie_perstn                  (pcie_perstn),
    .pcie_refclk_clk_n            (pcie_refclk_clk_n),
    .pcie_refclk_clk_p            (pcie_refclk_clk_p)
    );
    
  //assign M_AXIS_0_tready = 1'b0;

  
  



endmodule
