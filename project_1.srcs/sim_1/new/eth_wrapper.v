//////////////////////////////////////////////////////////////////////////////
//                     ┌▄╗╗╗░▄┌┌
//              ╓▄▒▓╜└╙╙─╫▄░║▄▒╠╛▒▓▒▒▄
//            ▒▒▀╙▓▓╣╝╜╗▒▄┌╙▓╛▀┤╗▄▄▄║╛▒▓▒▄
//           ╫▒╔ ╙╫▓╝╝╪╗ ╙▓▓ ▒╚▄ └┌║▓╚╪▄┘▀▓
//          ▐░ └┌ ║▓▓▒▄▄▒▒│▒║▄▒╢▀╝╙└ └╔┘║▄│▀▒
//          ▀│╠▓─║▓▓█▓▀└┌┐┐╔╕┌└╚ ┐┌    └┐│╫▄╙║▓
//           ╘▒▀ ╙┘╙└ ┌▄▄▄▄▄▄▄▄▄▄▄▄▄ ╔┌┌║  ║ ╙▒▒
//           ┌╓▄▄▓▒▓╙╙└▐║▄┌ ╓┌ └╓╓██─ ░╕▒ ┌└▄╓▓█─
//          ╓▀███▀▓▓▓▒▒███▄▄╫▌▄▄▓▓▀╓╗▒║▒╩  ┌░└╫░▌
//           └▓▓▓▓▓▓▓██████████▀▀▀ ║▓▓▒╠   ▒  ╫┌▒
//             ╙▀▀╙╙╜▀▒█▓█▓█▀└╓    █╩╒│─ ╓╫└  ║ ▒╗
//                    ▀▀╙─┌┌└ ┌▄▄╪▀ ╔└ ┌╪╙┐   ╜┐▒▄▄└┐
//                     ▓▓▓▒▓▓▓█▓▒│░└▄╗╜╘ ┌ ╒┌▒ ╔▓█▓▄╙
//                     ╫▒▒▒▓▒▀▒┌▄╢╜╙└ └ ╙ ╓╗└┌┌▄║█▓▌
//                    ╔██▓▓██▓╙┘░  │ ╙╓▒╗╜╙ ░└╓▌ ╙█▌
//                     ▓▓▓▓▀ ░ ┐║▄╗╜▀╙╓└ └ └▄▓▒▀▓▄▄▓─░
//                     ██▓▓▓╪▀║╙║ ░ │ │ ║▄╫▀▒╙╚┘└╙╙▀▒╔  ╖
//                     ██║░╢ ░│░╙╓▐▄▄▓╙╠└╓░╙└ ┌ │─└╔┘╙▒  ┌ ╘┐
//                     ▓▌▄▒▒▓▓▓▓▓▀╙┌┌╙┌┐│  │     └─╔┌╙┘▒▄ ┌╔ └╙▄
//                     ╙█▓█▓▒▀▀╚╔╓│┐┌ ╔      ┌┌   │┌ ╓┌└█╓┌└└┐ ┌╔
//                      ╫█▒▒╡╠▓░║▒▒▒▓│         └└╓╓┘└ └╔▒▒┐╔ └┌░╓╔
//                    ┌▓▓▓█▓▓▒▒▒▒▒▀└       └ └└ └╓║╓▒║░▒▒▒║▒  ┌░┘ ▒
//                  ╓▓█▓▓▓███▓▓██╠┌╕│      └┐ │▄▒▓▓▓▓║▓▒▒▒▒║░ │┌│▄║
//                 ╔╙╙└ ╙▓▓██▓██░▌▒╜░╔   ╓▄▄▄▓█▓█▓▓▀▒╫▌┘╙╩ ┘┌ │║░╠║
//               ▄▓╞└    ┌║▀▒▓█▒║▒╫▄└╕  ┌███▓██▓▓▓▓╙█▓▓▒▒╠░ ┌ ║╓┐╙▒
//             ╓▓▒╗═┌   ┌╓▒▒▒█▓╢╫░▒║│▄╓  ████▓████▒ ║█▓▒▒░░   │▐░▒
//             █▓▒║│┌┌  ▓██████╝▀╙└╚└▓▒▒▓█▓█▓▒██▓▀▒╕ ▀▀██▒▒▒╓░║║▒─
//             █▓▒▒╡╔  ▐█████╜╓╔▒┌   ▐▓╗▒▒▒▒▒▒▀▀▀█ ╓░ ┌╓ ╙▀▓▒░└╙
//             ║█║▒┐┐│╪▓▒█▒▒▌│▓╜░╙┌╓░ ▓▒▓▒▒█╢▒▓▓▓▒ ▓▒ ╠─┌    ┌╒
//            ▐╝░│└└║▒╠║████▌╙╙▓┐░╘▄└╔█▀╜╙╙▀▒▒▓╙ ╓┘ ║░ ╓┘  ║▒┘
//           ┌▌║▒╓╫▒▓▒▓▓╫▀▀▀▀▒░║▒│┘└└└┌ ┌││╙╙▀╙╙┌▀╓┌▓┐╓░  └╫▒╔░▒
//           ╙╙╙╙╙┴┘╙╜╜╜╜╜╜└▀╜╙╙╙╙╙└└╙╙└└╙┴╜┴┴┴┘╜╙└ └ └└└ └ └╜┴╜╙─
//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 06/30/2020 03:34:41 PM
// Design Name: 
// Module Name: eth_wrapper
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////
`define SIMULATION

module eth_wrapper(
    input               sys_reset,
    input               sw_rst,
    input               gt_refclk_p,
    input               gt_refclk_n,
    input               dclk,
    input               pcie_clk,
    
    input   [1:0]       gt_rxp_in,
    input   [1:0]       gt_rxn_in, 
    output  [1:0]       gt_txp_out,
    output  [1:0]       gt_txn_out,
    
    input               chnl_sw,
    
    output              rx_axis_tvalid,      
    output  [63:0]      rx_axis_tdata,
    output              rx_axis_tlast,       
    output  [7:0]       rx_axis_tkeep, 
    output              rx_axis_tuser,
    input               rx_axis_tready,
    
    output  [11:0]      rx_word_count,
    input               pop_rx_count,
    output              rx_word_count_valid,
    
//    output              rx_axis_tvalid_1,      
//    output  [63:0]      rx_axis_tdata_1,
//    output              rx_axis_tlast_1,       
//    output  [7:0]       rx_axis_tkeep_1, 
//    output              rx_axis_tuser_1,       
    
    output              tx_axis_tready,       
    input               tx_axis_tvalid,        
    input   [63 : 0]    tx_axis_tdata,
    input               tx_axis_tlast,         
    input   [7 : 0]     tx_axis_tkeep, 
    input               tx_axis_tuser,     
    
//    output              tx_axis_tready_1,       
//    input               tx_axis_tvalid_1,        
//    input   [63 : 0]    tx_axis_tdata_1,
//    input               tx_axis_tlast_1,         
//    input   [7 : 0]     tx_axis_tkeep_1, 
//    input               tx_axis_tuser_1,         
    
//    output              rx_clk_out_0,
//    output              tx_clk_out_0,
//    output              rx_clk_out_1,
//    output              tx_clk_out_1,

//    output              user_rx_reset_0,
//    output              user_rx_reset_1,
//    output              user_tx_reset_0,
//    output              user_tx_reset_1,
    
    
    output              stat_rx_status_0,
    output              stat_rx_block_lock_0, 
    output              stat_rx_status_1,
    output              stat_rx_block_lock_1,     
    output              stat_rx_bad_code_0,       
    output              stat_rx_valid_ctrl_code_0,
    output              stat_rx_bad_code_1, 
    output              stat_rx_valid_ctrl_code_1,
    output              stat_tx_local_fault_0, 
    output              stat_tx_local_fault_1,    
    output              stat_rx_local_fault_0,   
    output              stat_rx_local_fault_1,   
    output              stat_rx_remote_fault_0,
    output              stat_rx_remote_fault_1,  
    
    output  [1:0]       FS,
    output              qsfp1_rstn,
    input               mod_present1,
    output              qsfp1_lpmode,
    output              qsfp1_modselL 
    
    `ifdef SIMULATION
    ,input              paused
    ,output             available
    ,output  [31:0]     pktcount
    ,output             pcapfinished
    ,output [72:0]      fdout_l0
    ,output [72:0]      fdout_l1

    `endif
    
    );
    
    
  
  wire [2:0] gt_loopback_in_0; 
  wire user_rst;
  
  assign qsfp1_lpmode = 1'b0;
  assign qsfp1_modselL = 1'b1;
  assign FS = 2'b01;
  assign qsfp1_rstn = 1'b1;
  assign gt_loopback_in_0 = 3'b000;
  
  
  
  wire  restart_tx_rx_0;
  wire  send_continous_pkts_0;  
  wire  rx_gt_locked_led_0;     
  wire  rx_block_lock_led_0;    
           
  
  wire send_continous_pkts_1;  
  wire rx_gt_locked_led_1;     
  wire rx_block_lock_led_1;
   
          
    wire  block_lock_led_0;
  
                                                  
    wire  block_lock_led_1;
                                                  
    wire  block_lock_led_3;
    
    wire rx_core_clk_0;
    wire rx_clk_out_0;
    wire tx_clk_out_0;
    //assign rx_core_clk_0 = tx_clk_out_0;
    assign rx_core_clk_0 = rx_clk_out_0;
  
  
  //// RX_0 Signals
    wire rx_reset_0;
    wire user_rx_reset_0;
    wire rxrecclkout_0;
  
  //// RX_0 User Interface Signals
   (* mark_debug ="true" *)  wire rx_axis_tvalid_0;
   (* mark_debug ="true" *)  wire [63:0] rx_axis_tdata_0;
   (* mark_debug ="true" *)  wire rx_axis_tlast_0;
   (* mark_debug ="true" *)  wire [7:0] rx_axis_tkeep_0;
   (* mark_debug ="true" *)  wire rx_axis_tuser_0;
  
  //// RX_0 Control Signals
    wire ctl_rx_test_pattern_0;
    wire ctl_rx_test_pattern_enable_0;
    wire ctl_rx_data_pattern_select_0;
    wire ctl_rx_enable_0;
    wire ctl_rx_delete_fcs_0;
    wire ctl_rx_ignore_fcs_0;
    wire [14:0] ctl_rx_max_packet_len_0;
    wire [7:0] ctl_rx_min_packet_len_0;
    wire ctl_rx_check_sfd_0;
    wire ctl_rx_check_preamble_0;
    wire ctl_rx_process_lfi_0;
    wire ctl_rx_force_resync_0;
  
  
  //// RX_0 Stats Signals
    wire stat_rx_framing_err_valid_0;
    wire stat_rx_framing_err_0;
    wire stat_rx_hi_ber_0;
    wire [1:0] stat_rx_total_packets_0;
    wire stat_rx_total_good_packets_0;
    wire [3:0] stat_rx_total_bytes_0;
    wire [13:0] stat_rx_total_good_bytes_0;
    wire stat_rx_packet_small_0;
    wire stat_rx_jabber_0;
    wire stat_rx_packet_large_0;
    wire stat_rx_oversize_0;
    wire stat_rx_undersize_0;
    wire stat_rx_toolong_0;
    wire stat_rx_fragment_0;
    wire stat_rx_packet_64_bytes_0;
    wire stat_rx_packet_65_127_bytes_0;
    wire stat_rx_packet_128_255_bytes_0;
    wire stat_rx_packet_256_511_bytes_0;
    wire stat_rx_packet_512_1023_bytes_0;
    wire stat_rx_packet_1024_1518_bytes_0;
    wire stat_rx_packet_1519_1522_bytes_0;
    wire stat_rx_packet_1523_1548_bytes_0;
    wire [1:0] stat_rx_bad_fcs_0;
    wire stat_rx_packet_bad_fcs_0;
    wire [1:0] stat_rx_stomped_fcs_0;
    wire stat_rx_packet_1549_2047_bytes_0;
    wire stat_rx_packet_2048_4095_bytes_0;
    wire stat_rx_packet_4096_8191_bytes_0;
    wire stat_rx_packet_8192_9215_bytes_0;
    wire stat_rx_bad_preamble_0;
    wire stat_rx_bad_sfd_0;
    wire stat_rx_got_signal_os_0;
    wire stat_rx_test_pattern_mismatch_0;
    wire stat_rx_truncated_0;
    wire stat_rx_internal_local_fault_0;
    wire stat_rx_received_local_fault_0;
    
  //// TX_0 Signals
    wire tx_reset_0;
    wire user_tx_reset_0;
  
  //// TX_0 User Interface Signals
    wire tx_axis_tready_0;
    wire tx_axis_tvalid_0;
    wire [63:0] tx_axis_tdata_0;
    wire tx_axis_tlast_0;
    wire [7:0] tx_axis_tkeep_0;
    wire tx_axis_tuser_0;
    wire tx_unfout_0;
  
  //// TX_0 Control Signals
    wire ctl_tx_test_pattern_0;
    wire ctl_tx_test_pattern_enable_0;
    wire ctl_tx_test_pattern_select_0;
    wire ctl_tx_data_pattern_select_0;
    wire [57:0] ctl_tx_test_pattern_seed_a_0;
    wire [57:0] ctl_tx_test_pattern_seed_b_0;
    wire ctl_tx_enable_0;
    wire ctl_tx_fcs_ins_enable_0;
    wire ctl_tx_send_lfi_0;
    wire ctl_tx_send_rfi_0;
    wire ctl_tx_send_idle_0;
    wire ctl_tx_ignore_fcs_0;
  
  
  //// TX_0 Stats Signals
    wire stat_tx_total_packets_0;
    wire [3:0] stat_tx_total_bytes_0;
    wire stat_tx_total_good_packets_0;
    wire [13:0] stat_tx_total_good_bytes_0;
    wire stat_tx_packet_64_bytes_0;
    wire stat_tx_packet_65_127_bytes_0;
    wire stat_tx_packet_128_255_bytes_0;
    wire stat_tx_packet_256_511_bytes_0;
    wire stat_tx_packet_512_1023_bytes_0;
    wire stat_tx_packet_1024_1518_bytes_0;
    wire stat_tx_packet_1519_1522_bytes_0;
    wire stat_tx_packet_1523_1548_bytes_0;
    wire stat_tx_packet_small_0;
    wire stat_tx_packet_large_0;
    wire stat_tx_packet_1549_2047_bytes_0;
    wire stat_tx_packet_2048_4095_bytes_0;
    wire stat_tx_packet_4096_8191_bytes_0;
    wire stat_tx_packet_8192_9215_bytes_0;
    wire stat_tx_bad_fcs_0;
    wire stat_tx_frame_error_0;
  
    wire gtwiz_reset_tx_datapath_0;
    wire gtwiz_reset_rx_datapath_0;
    assign gtwiz_reset_tx_datapath_0 = 1'b0; 
    assign gtwiz_reset_rx_datapath_0 = 1'b0; 
    wire gtpowergood_out_0;
    wire [2:0] txoutclksel_in_0;
    wire [2:0] rxoutclksel_in_0;
    
    assign txoutclksel_in_0 = 3'b101;    // this value should not be changed as per gtwizard 
    assign rxoutclksel_in_0 = 3'b101;    // this value should not be changed as per gtwizard
    assign rx_block_lock_led_0 = block_lock_led_0 & stat_rx_status_0;
    wire rx_core_clk_1;
    wire rx_clk_out_1;
    wire tx_clk_out_1;
    //assign rx_core_clk_1 = tx_clk_out_1;
    assign rx_core_clk_1 = rx_clk_out_1;
  
  
  //// RX_1 Signals
    wire rx_reset_1;
    wire user_rx_reset_1;
    wire rxrecclkout_1;
  
  //// RX_1 User Interface Signals
   (* mark_debug ="true" *)  wire rx_axis_tvalid_1;
   (* mark_debug ="true" *)  wire [63:0] rx_axis_tdata_1;
   (* mark_debug ="true" *)  wire rx_axis_tlast_1;
   (* mark_debug ="true" *)  wire [7:0] rx_axis_tkeep_1;
   (* mark_debug ="true" *)  wire rx_axis_tuser_1;
  
  //// RX_1 Control Signals
    wire ctl_rx_test_pattern_1;
    wire ctl_rx_test_pattern_enable_1;
    wire ctl_rx_data_pattern_select_1;
    wire ctl_rx_enable_1;
    wire ctl_rx_delete_fcs_1;
    wire ctl_rx_ignore_fcs_1;
    wire [14:0] ctl_rx_max_packet_len_1;
    wire [7:0] ctl_rx_min_packet_len_1;
    wire ctl_rx_check_sfd_1;
    wire ctl_rx_check_preamble_1;
    wire ctl_rx_process_lfi_1;
    wire ctl_rx_force_resync_1;
  
  
  //// RX_1 Stats Signals
    wire stat_rx_framing_err_valid_1;
    wire stat_rx_framing_err_1;
    wire stat_rx_hi_ber_1;
    wire [1:0] stat_rx_total_packets_1;
    wire stat_rx_total_good_packets_1;
    wire [3:0] stat_rx_total_bytes_1;
    wire [13:0] stat_rx_total_good_bytes_1;
    wire stat_rx_packet_small_1;
    wire stat_rx_jabber_1;
    wire stat_rx_packet_large_1;
    wire stat_rx_oversize_1;
    wire stat_rx_undersize_1;
    wire stat_rx_toolong_1;
    wire stat_rx_fragment_1;
    wire stat_rx_packet_64_bytes_1;
    wire stat_rx_packet_65_127_bytes_1;
    wire stat_rx_packet_128_255_bytes_1;
    wire stat_rx_packet_256_511_bytes_1;
    wire stat_rx_packet_512_1023_bytes_1;
    wire stat_rx_packet_1024_1518_bytes_1;
    wire stat_rx_packet_1519_1522_bytes_1;
    wire stat_rx_packet_1523_1548_bytes_1;
    wire [1:0] stat_rx_bad_fcs_1;
    wire stat_rx_packet_bad_fcs_1;
    wire [1:0] stat_rx_stomped_fcs_1;
    wire stat_rx_packet_1549_2047_bytes_1;
    wire stat_rx_packet_2048_4095_bytes_1;
    wire stat_rx_packet_4096_8191_bytes_1;
    wire stat_rx_packet_8192_9215_bytes_1;
    wire stat_rx_bad_preamble_1;
    wire stat_rx_bad_sfd_1;
    wire stat_rx_got_signal_os_1;
    wire stat_rx_test_pattern_mismatch_1;
    wire stat_rx_truncated_1;
    wire stat_rx_internal_local_fault_1;
    wire stat_rx_received_local_fault_1;
  //// TX_1 Signals
    wire tx_reset_1;
    wire user_tx_reset_1;
  
  //// TX_1 User Interface Signals
    wire tx_axis_tready_1;
    wire tx_axis_tvalid_1;
    wire [63:0] tx_axis_tdata_1;
    wire tx_axis_tlast_1;
    wire [7:0] tx_axis_tkeep_1;
    wire tx_axis_tuser_1;
    wire tx_unfout_1;
  
  //// TX_1 Control Signals
    wire ctl_tx_test_pattern_1;
    wire ctl_tx_test_pattern_enable_1;
    wire ctl_tx_test_pattern_select_1;
    wire ctl_tx_data_pattern_select_1;
    wire [57:0] ctl_tx_test_pattern_seed_a_1;
    wire [57:0] ctl_tx_test_pattern_seed_b_1;
    wire ctl_tx_enable_1;
    wire ctl_tx_fcs_ins_enable_1;
    wire ctl_tx_send_lfi_1;
    wire ctl_tx_send_rfi_1;
    wire ctl_tx_send_idle_1;
    wire ctl_tx_ignore_fcs_1;
  
  
  //// TX_1 Stats Signals
    wire stat_tx_total_packets_1;
    wire [3:0] stat_tx_total_bytes_1;
    wire stat_tx_total_good_packets_1;
    wire [13:0] stat_tx_total_good_bytes_1;
    wire stat_tx_packet_64_bytes_1;
    wire stat_tx_packet_65_127_bytes_1;
    wire stat_tx_packet_128_255_bytes_1;
    wire stat_tx_packet_256_511_bytes_1;
    wire stat_tx_packet_512_1023_bytes_1;
    wire stat_tx_packet_1024_1518_bytes_1;
    wire stat_tx_packet_1519_1522_bytes_1;
    wire stat_tx_packet_1523_1548_bytes_1;
    wire stat_tx_packet_small_1;
    wire stat_tx_packet_large_1;
    wire stat_tx_packet_1549_2047_bytes_1;
    wire stat_tx_packet_2048_4095_bytes_1;
    wire stat_tx_packet_4096_8191_bytes_1;
    wire stat_tx_packet_8192_9215_bytes_1;
    wire stat_tx_bad_fcs_1;
    wire stat_tx_frame_error_1;
  
    wire gtwiz_reset_tx_datapath_1;
    wire gtwiz_reset_rx_datapath_1;
    assign gtwiz_reset_tx_datapath_1    = 1'b0; 
    assign gtwiz_reset_rx_datapath_1    = 1'b0; 
    wire gtpowergood_out_1;
    wire [2:0] txoutclksel_in_1;
    wire [2:0] rxoutclksel_in_1;
    
    assign txoutclksel_in_1             = 3'b101;    // this value should not be changed as per gtwizard 
    assign rxoutclksel_in_1             = 3'b101;    // this value should not be changed as per gtwizard
    assign rx_block_lock_led_1          = block_lock_led_1 & stat_rx_status_1;
      
    assign tx_reset_0                   = 1'b0;
    assign ctl_tx_enable_0              = 1'b1;
    assign ctl_tx_send_rfi_0            = 1'b0;
    assign ctl_tx_send_lfi_0            = 1'b0;
    assign ctl_tx_send_idle_0           = 1'b0;
    assign ctl_tx_fcs_ins_enable_0      = 1'b1;
    assign ctl_tx_ignore_fcs_0          = 1'b0;
    assign ctl_tx_test_pattern_0        = 1'b0;
    assign ctl_tx_test_pattern_enable_0 = 1'b0;
    assign ctl_tx_data_pattern_select_0 = 1'b0;
    assign ctl_tx_test_pattern_select_0 = 1'b0;
    assign ctl_tx_test_pattern_seed_a_0 = 58'h0;
    assign ctl_tx_test_pattern_seed_b_0 = 58'h0;
    assign ctl_rx_test_pattern_0        = 1'b0;
    
    assign rx_reset_0                   = 1'b0;
    assign ctl_rx_enable_0              = 1'b1;
    assign ctl_rx_check_preamble_0      = 1'b1;
    assign ctl_rx_check_sfd_0           = 1'b1;
    assign ctl_rx_force_resync_0        = 1'b0;
    assign ctl_rx_delete_fcs_0          = 1'b1;
    assign ctl_rx_ignore_fcs_0          = 1'b0;
    assign ctl_rx_process_lfi_0         = 1'b0;
    assign ctl_rx_test_pattern_0        = 1'b0;
    assign ctl_rx_test_pattern_enable_0 = 1'b0;
    assign ctl_rx_data_pattern_select_0 = 1'b0;
    assign ctl_rx_max_packet_len_0      = 15'd9600;
    assign ctl_rx_min_packet_len_0      = 64;
    
    assign tx_reset_1                   = 1'b0;
    assign ctl_tx_enable_1              = 1'b1;
    assign ctl_tx_send_rfi_1            = 1'b0;
    assign ctl_tx_send_lfi_1            = 1'b0;
    assign ctl_tx_send_idle_1           = 1'b0;
    assign ctl_tx_fcs_ins_enable_1      = 1'b1;
    assign ctl_tx_ignore_fcs_1          = 1'b0;
    assign ctl_tx_test_pattern_1        = 1'b0;
    assign ctl_tx_test_pattern_enable_1 = 1'b0;
    assign ctl_tx_data_pattern_select_1 = 1'b0;
    assign ctl_tx_test_pattern_select_1 = 1'b0;
    assign ctl_tx_test_pattern_seed_a_1 = 58'h0;
    assign ctl_tx_test_pattern_seed_b_1 = 58'h0;
    assign ctl_rx_test_pattern_1        = 1'b0;
    
    assign rx_reset_1                   = 1'b0;
    assign ctl_rx_enable_1              = 1'b1;
    assign ctl_rx_check_preamble_1      = 1'b1;
    assign ctl_rx_check_sfd_1           = 1'b1;
    assign ctl_rx_force_resync_1        = 1'b0;
    assign ctl_rx_delete_fcs_1          = 1'b1;
    assign ctl_rx_ignore_fcs_1          = 1'b0;
    assign ctl_rx_process_lfi_1         = 1'b0;
    assign ctl_rx_test_pattern_1        = 1'b0;
    assign ctl_rx_test_pattern_enable_1 = 1'b0;
    assign ctl_rx_data_pattern_select_1 = 1'b0;
    assign ctl_rx_max_packet_len_1      = 15'd9600;
    assign ctl_rx_min_packet_len_1      = 64;
  
    wire  gt_refclk_out;
  
  
`ifndef SIMULATION  
  eth_10Gx2_qsfp1 eth_10Gx2_qsfp1_inst
  (
      .gt_rxp_in                        (gt_rxp_in),
      .gt_rxn_in                        (gt_rxn_in),
      .gt_txp_out                       (gt_txp_out),
      .gt_txn_out                       (gt_txn_out),
      .tx_clk_out_0                     (tx_clk_out_0),
      .rx_core_clk_0                    (rx_core_clk_0),
      .rx_clk_out_0                     (rx_clk_out_0),
  
      .gt_loopback_in_0                 (gt_loopback_in_0),
      .rx_reset_0                       (rx_reset_0),
      .user_rx_reset_0                  (user_rx_reset_0),
      .rxrecclkout_0                    (rxrecclkout_0),
  
  
  //// RX User Interface Signals
      .rx_axis_tvalid_0                 (rx_axis_tvalid_0),
      .rx_axis_tdata_0                  (rx_axis_tdata_0),
      .rx_axis_tlast_0                  (rx_axis_tlast_0),
      .rx_axis_tkeep_0                  (rx_axis_tkeep_0),
      .rx_axis_tuser_0                  (rx_axis_tuser_0),
  
  
  //// RX Control Signals
      .ctl_rx_test_pattern_0            (ctl_rx_test_pattern_0),
      .ctl_rx_test_pattern_enable_0     (ctl_rx_test_pattern_enable_0),
      .ctl_rx_data_pattern_select_0     (ctl_rx_data_pattern_select_0),
      .ctl_rx_enable_0                  (ctl_rx_enable_0),
      .ctl_rx_delete_fcs_0              (ctl_rx_delete_fcs_0),
      .ctl_rx_ignore_fcs_0              (ctl_rx_ignore_fcs_0),
      .ctl_rx_max_packet_len_0          (ctl_rx_max_packet_len_0),
      .ctl_rx_min_packet_len_0          (ctl_rx_min_packet_len_0),
      .ctl_rx_check_sfd_0               (ctl_rx_check_sfd_0),
      .ctl_rx_check_preamble_0          (ctl_rx_check_preamble_0),
      .ctl_rx_process_lfi_0             (ctl_rx_process_lfi_0),
      .ctl_rx_force_resync_0            (ctl_rx_force_resync_0),
  
  
  
  
  //// RX Stats Signals
      .stat_rx_block_lock_0             (stat_rx_block_lock_0),
      .stat_rx_framing_err_valid_0      (stat_rx_framing_err_valid_0),
      .stat_rx_framing_err_0            (stat_rx_framing_err_0),
      .stat_rx_hi_ber_0                 (stat_rx_hi_ber_0),
      .stat_rx_valid_ctrl_code_0        (stat_rx_valid_ctrl_code_0),
      .stat_rx_bad_code_0               (stat_rx_bad_code_0),
      .stat_rx_total_packets_0          (stat_rx_total_packets_0),
      .stat_rx_total_good_packets_0     (stat_rx_total_good_packets_0),
      .stat_rx_total_bytes_0            (stat_rx_total_bytes_0),
      .stat_rx_total_good_bytes_0       (stat_rx_total_good_bytes_0),
      .stat_rx_packet_small_0           (stat_rx_packet_small_0),
      .stat_rx_jabber_0                 (stat_rx_jabber_0),
      .stat_rx_packet_large_0           (stat_rx_packet_large_0),
      .stat_rx_oversize_0               (stat_rx_oversize_0),
      .stat_rx_undersize_0              (stat_rx_undersize_0),
      .stat_rx_toolong_0                (stat_rx_toolong_0),
      .stat_rx_fragment_0               (stat_rx_fragment_0),
      .stat_rx_packet_64_bytes_0        (stat_rx_packet_64_bytes_0),
      .stat_rx_packet_65_127_bytes_0    (stat_rx_packet_65_127_bytes_0),
      .stat_rx_packet_128_255_bytes_0   (stat_rx_packet_128_255_bytes_0),
      .stat_rx_packet_256_511_bytes_0   (stat_rx_packet_256_511_bytes_0),
      .stat_rx_packet_512_1023_bytes_0  (stat_rx_packet_512_1023_bytes_0),
      .stat_rx_packet_1024_1518_bytes_0 (stat_rx_packet_1024_1518_bytes_0),
      .stat_rx_packet_1519_1522_bytes_0 (stat_rx_packet_1519_1522_bytes_0),
      .stat_rx_packet_1523_1548_bytes_0 (stat_rx_packet_1523_1548_bytes_0),
      .stat_rx_bad_fcs_0                (stat_rx_bad_fcs_0),
      .stat_rx_packet_bad_fcs_0         (stat_rx_packet_bad_fcs_0),
      .stat_rx_stomped_fcs_0            (stat_rx_stomped_fcs_0),
      .stat_rx_packet_1549_2047_bytes_0 (stat_rx_packet_1549_2047_bytes_0),
      .stat_rx_packet_2048_4095_bytes_0 (stat_rx_packet_2048_4095_bytes_0),
      .stat_rx_packet_4096_8191_bytes_0 (stat_rx_packet_4096_8191_bytes_0),
      .stat_rx_packet_8192_9215_bytes_0 (stat_rx_packet_8192_9215_bytes_0),
      .stat_rx_bad_preamble_0           (stat_rx_bad_preamble_0),
      .stat_rx_bad_sfd_0                (stat_rx_bad_sfd_0),
      .stat_rx_got_signal_os_0          (stat_rx_got_signal_os_0),
      .stat_rx_test_pattern_mismatch_0  (stat_rx_test_pattern_mismatch_0),
      .stat_rx_truncated_0              (stat_rx_truncated_0),
      .stat_rx_local_fault_0            (stat_rx_local_fault_0),
      .stat_rx_remote_fault_0           (stat_rx_remote_fault_0),
      .stat_rx_internal_local_fault_0   (stat_rx_internal_local_fault_0),
      .stat_rx_received_local_fault_0   (stat_rx_received_local_fault_0),
      .stat_rx_status_0                 (stat_rx_status_0),
  
      .tx_reset_0                       (tx_reset_0),
      .user_tx_reset_0                  (user_tx_reset_0),
  //// TX User Interface Signals
      .tx_axis_tready_0                 (tx_axis_tready_0),
      .tx_axis_tvalid_0                 (tx_axis_tvalid_0),
      .tx_axis_tdata_0                  (tx_axis_tdata_0),
      .tx_axis_tlast_0                  (tx_axis_tlast_0),
      .tx_axis_tkeep_0                  (tx_axis_tkeep_0),
      .tx_axis_tuser_0                  (tx_axis_tuser_0),
      .tx_unfout_0                      (tx_unfout_0),
  
  //// TX Control Signals
      .ctl_tx_test_pattern_0            (ctl_tx_test_pattern_0),
      .ctl_tx_test_pattern_enable_0     (ctl_tx_test_pattern_enable_0),
      .ctl_tx_test_pattern_select_0     (ctl_tx_test_pattern_select_0),
      .ctl_tx_data_pattern_select_0     (ctl_tx_data_pattern_select_0),
      .ctl_tx_test_pattern_seed_a_0     (ctl_tx_test_pattern_seed_a_0),
      .ctl_tx_test_pattern_seed_b_0     (ctl_tx_test_pattern_seed_b_0),
      .ctl_tx_enable_0                  (ctl_tx_enable_0),
      .ctl_tx_fcs_ins_enable_0          (ctl_tx_fcs_ins_enable_0),
      .ctl_tx_send_lfi_0                (ctl_tx_send_lfi_0),
      .ctl_tx_send_rfi_0                (ctl_tx_send_rfi_0),
      .ctl_tx_send_idle_0               (ctl_tx_send_idle_0),
      .ctl_tx_ignore_fcs_0              (ctl_tx_ignore_fcs_0),
  
  
  //// TX Stats Signals
      .stat_tx_total_packets_0          (stat_tx_total_packets_0),
      .stat_tx_total_bytes_0            (stat_tx_total_bytes_0),
      .stat_tx_total_good_packets_0     (stat_tx_total_good_packets_0),
      .stat_tx_total_good_bytes_0       (stat_tx_total_good_bytes_0),
      .stat_tx_packet_64_bytes_0        (stat_tx_packet_64_bytes_0),
      .stat_tx_packet_65_127_bytes_0    (stat_tx_packet_65_127_bytes_0),
      .stat_tx_packet_128_255_bytes_0   (stat_tx_packet_128_255_bytes_0),
      .stat_tx_packet_256_511_bytes_0   (stat_tx_packet_256_511_bytes_0),
      .stat_tx_packet_512_1023_bytes_0  (stat_tx_packet_512_1023_bytes_0),
      .stat_tx_packet_1024_1518_bytes_0 (stat_tx_packet_1024_1518_bytes_0),
      .stat_tx_packet_1519_1522_bytes_0 (stat_tx_packet_1519_1522_bytes_0),
      .stat_tx_packet_1523_1548_bytes_0 (stat_tx_packet_1523_1548_bytes_0),
      .stat_tx_packet_small_0           (stat_tx_packet_small_0),
      .stat_tx_packet_large_0           (stat_tx_packet_large_0),
      .stat_tx_packet_1549_2047_bytes_0 (stat_tx_packet_1549_2047_bytes_0),
      .stat_tx_packet_2048_4095_bytes_0 (stat_tx_packet_2048_4095_bytes_0),
      .stat_tx_packet_4096_8191_bytes_0 (stat_tx_packet_4096_8191_bytes_0),
      .stat_tx_packet_8192_9215_bytes_0 (stat_tx_packet_8192_9215_bytes_0),
      .stat_tx_bad_fcs_0                (stat_tx_bad_fcs_0),
      .stat_tx_frame_error_0            (stat_tx_frame_error_0),
      .stat_tx_local_fault_0            (stat_tx_local_fault_0),
  
  
  
      .gtwiz_reset_tx_datapath_0        (gtwiz_reset_tx_datapath_0),
      .gtwiz_reset_rx_datapath_0        (gtwiz_reset_rx_datapath_0),
      .gtpowergood_out_0                (gtpowergood_out_0),
      .txoutclksel_in_0                 (txoutclksel_in_0),
      .rxoutclksel_in_0                 (rxoutclksel_in_0),
      .tx_clk_out_1                     (tx_clk_out_1),
      .rx_core_clk_1                    (rx_core_clk_1),
      .rx_clk_out_1                     (rx_clk_out_1),
  
      .gt_loopback_in_1                 (gt_loopback_in_0),
      .rx_reset_1                       (rx_reset_1),
      .user_rx_reset_1                  (user_rx_reset_1),
      .rxrecclkout_1                    (rxrecclkout_1),
  
  
  //// RX User Interface Signals
      .rx_axis_tvalid_1                 (rx_axis_tvalid_1),
      .rx_axis_tdata_1                  (rx_axis_tdata_1),
      .rx_axis_tlast_1                  (rx_axis_tlast_1),
      .rx_axis_tkeep_1                  (rx_axis_tkeep_1),
      .rx_axis_tuser_1                  (rx_axis_tuser_1),
  
  
  //// RX Control Signals
      .ctl_rx_test_pattern_1            (ctl_rx_test_pattern_1),
      .ctl_rx_test_pattern_enable_1     (ctl_rx_test_pattern_enable_1),
      .ctl_rx_data_pattern_select_1     (ctl_rx_data_pattern_select_1),
      .ctl_rx_enable_1                  (ctl_rx_enable_1),
      .ctl_rx_delete_fcs_1              (ctl_rx_delete_fcs_1),
      .ctl_rx_ignore_fcs_1              (ctl_rx_ignore_fcs_1),
      .ctl_rx_max_packet_len_1          (ctl_rx_max_packet_len_1),
      .ctl_rx_min_packet_len_1          (ctl_rx_min_packet_len_1),
      .ctl_rx_check_sfd_1               (ctl_rx_check_sfd_1),
      .ctl_rx_check_preamble_1          (ctl_rx_check_preamble_1),
      .ctl_rx_process_lfi_1             (ctl_rx_process_lfi_1),
      .ctl_rx_force_resync_1            (ctl_rx_force_resync_1),
  
  
  
  
  //// RX Stats Signals
      .stat_rx_block_lock_1             (stat_rx_block_lock_1),
      .stat_rx_framing_err_valid_1      (stat_rx_framing_err_valid_1),
      .stat_rx_framing_err_1            (stat_rx_framing_err_1),
      .stat_rx_hi_ber_1                 (stat_rx_hi_ber_1),
      .stat_rx_valid_ctrl_code_1        (stat_rx_valid_ctrl_code_1),
      .stat_rx_bad_code_1               (stat_rx_bad_code_1),
      .stat_rx_total_packets_1          (stat_rx_total_packets_1),
      .stat_rx_total_good_packets_1     (stat_rx_total_good_packets_1),
      .stat_rx_total_bytes_1            (stat_rx_total_bytes_1),
      .stat_rx_total_good_bytes_1       (stat_rx_total_good_bytes_1),
      .stat_rx_packet_small_1           (stat_rx_packet_small_1),
      .stat_rx_jabber_1                 (stat_rx_jabber_1),
      .stat_rx_packet_large_1           (stat_rx_packet_large_1),
      .stat_rx_oversize_1               (stat_rx_oversize_1),
      .stat_rx_undersize_1              (stat_rx_undersize_1),
      .stat_rx_toolong_1                (stat_rx_toolong_1),
      .stat_rx_fragment_1               (stat_rx_fragment_1),
      .stat_rx_packet_64_bytes_1        (stat_rx_packet_64_bytes_1),
      .stat_rx_packet_65_127_bytes_1    (stat_rx_packet_65_127_bytes_1),
      .stat_rx_packet_128_255_bytes_1   (stat_rx_packet_128_255_bytes_1),
      .stat_rx_packet_256_511_bytes_1   (stat_rx_packet_256_511_bytes_1),
      .stat_rx_packet_512_1023_bytes_1  (stat_rx_packet_512_1023_bytes_1),
      .stat_rx_packet_1024_1518_bytes_1 (stat_rx_packet_1024_1518_bytes_1),
      .stat_rx_packet_1519_1522_bytes_1 (stat_rx_packet_1519_1522_bytes_1),
      .stat_rx_packet_1523_1548_bytes_1 (stat_rx_packet_1523_1548_bytes_1),
      .stat_rx_bad_fcs_1                (stat_rx_bad_fcs_1),
      .stat_rx_packet_bad_fcs_1         (stat_rx_packet_bad_fcs_1),
      .stat_rx_stomped_fcs_1            (stat_rx_stomped_fcs_1),
      .stat_rx_packet_1549_2047_bytes_1 (stat_rx_packet_1549_2047_bytes_1),
      .stat_rx_packet_2048_4095_bytes_1 (stat_rx_packet_2048_4095_bytes_1),
      .stat_rx_packet_4096_8191_bytes_1 (stat_rx_packet_4096_8191_bytes_1),
      .stat_rx_packet_8192_9215_bytes_1 (stat_rx_packet_8192_9215_bytes_1),
      .stat_rx_bad_preamble_1           (stat_rx_bad_preamble_1),
      .stat_rx_bad_sfd_1                (stat_rx_bad_sfd_1),
      .stat_rx_got_signal_os_1          (stat_rx_got_signal_os_1),
      .stat_rx_test_pattern_mismatch_1  (stat_rx_test_pattern_mismatch_1),
      .stat_rx_truncated_1              (stat_rx_truncated_1),
      .stat_rx_local_fault_1            (stat_rx_local_fault_1),
      .stat_rx_remote_fault_1           (stat_rx_remote_fault_1),
      .stat_rx_internal_local_fault_1   (stat_rx_internal_local_fault_1),
      .stat_rx_received_local_fault_1   (stat_rx_received_local_fault_1),
      .stat_rx_status_1                 (stat_rx_status_1),
  
      .tx_reset_1                       (tx_reset_1),
      .user_tx_reset_1                  (user_tx_reset_1),
  //// TX User Interface Signals
      .tx_axis_tready_1                 (tx_axis_tready_1),
      .tx_axis_tvalid_1                 (tx_axis_tvalid_1),
      .tx_axis_tdata_1                  (tx_axis_tdata_1),
      .tx_axis_tlast_1                  (tx_axis_tlast_1),
      .tx_axis_tkeep_1                  (tx_axis_tkeep_1),
      .tx_axis_tuser_1                  (tx_axis_tuser_1),
      .tx_unfout_1                      (tx_unfout_1),
  
  //// TX Control Signals
      .ctl_tx_test_pattern_1            (ctl_tx_test_pattern_1),
      .ctl_tx_test_pattern_enable_1     (ctl_tx_test_pattern_enable_1),
      .ctl_tx_test_pattern_select_1     (ctl_tx_test_pattern_select_1),
      .ctl_tx_data_pattern_select_1     (ctl_tx_data_pattern_select_1),
      .ctl_tx_test_pattern_seed_a_1     (ctl_tx_test_pattern_seed_a_1),
      .ctl_tx_test_pattern_seed_b_1     (ctl_tx_test_pattern_seed_b_1),
      .ctl_tx_enable_1                  (ctl_tx_enable_1),
      .ctl_tx_fcs_ins_enable_1          (ctl_tx_fcs_ins_enable_1),
      .ctl_tx_send_lfi_1                (ctl_tx_send_lfi_1),
      .ctl_tx_send_rfi_1                (ctl_tx_send_rfi_1),
      .ctl_tx_send_idle_1               (ctl_tx_send_idle_1),
      .ctl_tx_ignore_fcs_1              (ctl_tx_ignore_fcs_1),
  
  
  //// TX Stats Signals
      .stat_tx_total_packets_1          (stat_tx_total_packets_1),
      .stat_tx_total_bytes_1            (stat_tx_total_bytes_1),
      .stat_tx_total_good_packets_1     (stat_tx_total_good_packets_1),
      .stat_tx_total_good_bytes_1       (stat_tx_total_good_bytes_1),
      .stat_tx_packet_64_bytes_1        (stat_tx_packet_64_bytes_1),
      .stat_tx_packet_65_127_bytes_1    (stat_tx_packet_65_127_bytes_1),
      .stat_tx_packet_128_255_bytes_1   (stat_tx_packet_128_255_bytes_1),
      .stat_tx_packet_256_511_bytes_1   (stat_tx_packet_256_511_bytes_1),
      .stat_tx_packet_512_1023_bytes_1  (stat_tx_packet_512_1023_bytes_1),
      .stat_tx_packet_1024_1518_bytes_1 (stat_tx_packet_1024_1518_bytes_1),
      .stat_tx_packet_1519_1522_bytes_1 (stat_tx_packet_1519_1522_bytes_1),
      .stat_tx_packet_1523_1548_bytes_1 (stat_tx_packet_1523_1548_bytes_1),
      .stat_tx_packet_small_1           (stat_tx_packet_small_1),
      .stat_tx_packet_large_1           (stat_tx_packet_large_1),
      .stat_tx_packet_1549_2047_bytes_1 (stat_tx_packet_1549_2047_bytes_1),
      .stat_tx_packet_2048_4095_bytes_1 (stat_tx_packet_2048_4095_bytes_1),
      .stat_tx_packet_4096_8191_bytes_1 (stat_tx_packet_4096_8191_bytes_1),
      .stat_tx_packet_8192_9215_bytes_1 (stat_tx_packet_8192_9215_bytes_1),
      .stat_tx_bad_fcs_1                (stat_tx_bad_fcs_1),
      .stat_tx_frame_error_1            (stat_tx_frame_error_1),
      .stat_tx_local_fault_1            (stat_tx_local_fault_1),
  
      .gtwiz_reset_tx_datapath_1        (gtwiz_reset_tx_datapath_1),
      .gtwiz_reset_rx_datapath_1        (gtwiz_reset_rx_datapath_1),
      .gtpowergood_out_1                (gtpowergood_out_1),
      .txoutclksel_in_1                 (txoutclksel_in_1),
      .rxoutclksel_in_1                 (rxoutclksel_in_1),
  
      .gt_refclk_p                      (gt_refclk_p),
      .gt_refclk_n                      (gt_refclk_n),
      .gt_refclk_out                    (gt_refclk_out),
      .sys_reset                        (sys_reset),
      .dclk                             (dclk)
  );
  `else

    // Instantiate the Unit Under Test (UUT)
    pcapparser_10gbmac #(
        .pcap_filename( "../../../../pcap/capture.pcap" ),
        .ipg                (4)
    ) pcap (
        .rx_clk_out_0       (rx_clk_out_0),
        .rx_clk_out_1       (rx_clk_out_1),

        .pause              (paused),
        .available          (available),
        .pktcount           (pktcount),
        .pcapfinished       (pcapfinished),

        .rx_axis_tdata_o    (rx_axis_tdata_0),
        .rx_axis_tvalid_o   (rx_axis_tvalid_0),
        .rx_axis_tlast_o    (rx_axis_tlast_0),
        .rx_axis_tkeep_o    (rx_axis_tkeep_0), 
        .rx_axis_tuser_o    (rx_axis_tuser_0)

    );


    assign rx_axis_tdata_1 = rx_axis_tdata_0;
    assign rx_axis_tvalid_1 = rx_axis_tvalid_0;
    assign rx_axis_tlast_1 = rx_axis_tlast_0;
    assign rx_axis_tkeep_1 = rx_axis_tkeep_0;
    assign rx_axis_tuser_1 = rx_axis_tuser_0;
    
  `endif
  
   reg rx_rst_0;
   reg rx_rst1_0;
   reg rx_rst2_0;
   
   reg rx_rst_1;
   reg rx_rst1_1;
   reg rx_rst2_1;
   
   reg pcie_rst;
   reg pcie_rst1;
   reg pcie_rst2;
   
   wire fdvalid_l0;       
   wire [72:0] fdout_l0;
   wire fifo_rd_l0;
   
    wire fdvalid_l1;       
    wire [72:0] fdout_l1;
    wire fifo_rd_l1;
    
    reg chnl_sw_rxclk0;
    reg chnl_sw_rxclk0_1;
    reg chnl_sw_rxclk0_2;
    
    reg chnl_sw_rxclk1;
    reg chnl_sw_rxclk1_1;
    reg chnl_sw_rxclk1_2;
    
    reg chnl_sw_pclk;
    reg chnl_sw_pclk_1;
    reg chnl_sw_pclk_2;
    
    reg  wr_state_l0;
    reg  wr_state_l1;
    
    reg wr_mode_l0;
    reg wr_mode_l1;
    
    wire prog_full_l0;
    wire prog_empt_l0;
    wire prog_full_l1;
    wire prog_empt_l1;
    
    reg prog_empt_l0_wrclk;
    reg prog_empt_l0_wrclk_int;
    reg prog_empt_l0_wrclk_int1;
    
    reg prog_empt_l1_wrclk;
    reg prog_empt_l1_wrclk_int;
    reg prog_empt_l1_wrclk_int1;
    
 ///////////////////////////////////// Sync reset and chnl select signal generation /////////////////////////////   
  always @(posedge rx_clk_out_0) begin
      rx_rst1_0 <= sw_rst;
      rx_rst2_0 <= rx_rst1_0;
      rx_rst_0 <= rx_rst2_0;
      
      chnl_sw_rxclk0_1 <= chnl_sw;
      chnl_sw_rxclk0_2 <= chnl_sw_rxclk0_1;
      chnl_sw_rxclk0   <= chnl_sw_rxclk0_2;
  end
    
  always @(posedge rx_clk_out_1) begin
      rx_rst1_1 <= sw_rst;
      rx_rst2_1 <= rx_rst1_1;
      rx_rst_1 <= rx_rst2_1;
      
      chnl_sw_rxclk1_1 <= chnl_sw;
      chnl_sw_rxclk1_2 <= chnl_sw_rxclk1_1;
      chnl_sw_rxclk1   <= chnl_sw_rxclk1_2;
  end
  
  always @(posedge pcie_clk) begin
        pcie_rst1 <= sw_rst;
        pcie_rst2 <= pcie_rst1;
        pcie_rst <= pcie_rst2;
        
        chnl_sw_pclk_1 <= chnl_sw;
        chnl_sw_pclk_2 <= chnl_sw_pclk_1;
        chnl_sw_pclk   <= chnl_sw_pclk_2;
  end
  
  ////////////////////////////////////// write mode toggle logic //////////////////////////////////////////
  // drops the first packet after reset and when moving drop mode to write mode when buffer almost full  //
  always @(posedge rx_clk_out_0) begin
    prog_empt_l0_wrclk_int <= prog_empt_l0;
    prog_empt_l0_wrclk_int1 <= prog_empt_l0_wrclk_int;
    prog_empt_l0_wrclk <= prog_empt_l0_wrclk_int1;
  end
  
  always @(posedge rx_clk_out_1) begin
      prog_empt_l1_wrclk_int <= prog_empt_l1;
      prog_empt_l1_wrclk_int1 <= prog_empt_l1_wrclk_int;
      prog_empt_l1_wrclk <= prog_empt_l1_wrclk_int1;
    end
  
  always @(posedge rx_clk_out_0) begin
    if(rx_rst_0) begin
        wr_mode_l0 <= 1'b0;
        wr_state_l0 <= 1'b1;
     end
     else begin
        case (wr_state_l0)
            1'b0 : begin
                wr_mode_l0 <= 1'b1;
                if(prog_full_l0 & rx_axis_tlast_0 & rx_axis_tvalid_0) begin
                    wr_state_l0 <= 1'b1;
                    wr_mode_l0 <= 1'b0;
                end
                end
             1'b1 : begin
                wr_mode_l0 <= 1'b0;
                if(prog_empt_l0_wrclk & rx_axis_tlast_0 & rx_axis_tvalid_0) begin
                    wr_state_l0 <= 1'b0;
                    wr_mode_l0 <= 1'b1;
                end
                end
           endcase
       end
  end
  
    always @(posedge rx_clk_out_1) begin
    if(rx_rst_1) begin
        wr_mode_l1 <= 1'b0;
        wr_state_l1 <= 1'b1;
     end
     else begin
        case (wr_state_l1)
            1'b0 : begin
                wr_mode_l1 <= 1'b1;
                if(prog_full_l1 & rx_axis_tlast_1 & rx_axis_tvalid_1) begin
                    wr_state_l1 <= 1'b1;
                    wr_mode_l1 <= 1'b0;
                end
                end
             1'b1 : begin
                wr_mode_l1 <= 1'b0;
                if(prog_empt_l1_wrclk & rx_axis_tlast_1 & rx_axis_tvalid_1) begin
                    wr_state_l1 <= 1'b0;
                    wr_mode_l1 <= 1'b1;
                end
                end
           endcase
       end
  end
////////////////////////////////////////////////////////////////////////////////////////////////////
    
  xpm_fifo_async #(
           .CDC_SYNC_STAGES(2),       // DECIMAL
           .DOUT_RESET_VALUE("0"),    // String
           .ECC_MODE("no_ecc"),       // String
           .FIFO_MEMORY_TYPE("auto"), // String
           .FIFO_READ_LATENCY(1),     // DECIMAL
           .FIFO_WRITE_DEPTH(2048),   // DECIMAL
           .FULL_RESET_VALUE(0),      // DECIMAL
           .PROG_EMPTY_THRESH(300),//1000),    // DECIMAL
           .PROG_FULL_THRESH(750),//1750),     // DECIMAL
           .RD_DATA_COUNT_WIDTH(1),   // DECIMAL
           .READ_DATA_WIDTH(73),      // DECIMAL 1+8+64
           .READ_MODE("fwft"),         // String
           .RELATED_CLOCKS(0),        // DECIMAL
           .USE_ADV_FEATURES("1707"), // String
           .WAKEUP_TIME(0),           // DECIMAL
           .WRITE_DATA_WIDTH(73),     // DECIMAL
           .WR_DATA_COUNT_WIDTH(1)    // DECIMAL
        )
        xpm_fifo_async_rx_l0 (
           .almost_empty(),   
           .almost_full(),     
           .dbiterr(),             
           .empty(),                 
           .full(),                   
           .overflow(),           
           .prog_empty(prog_empt_l0),       
           .prog_full(prog_full_l0),         
           .rd_data_count(), 
           .rd_rst_busy(),     
           .sbiterr(),             
           .underflow(),         
           .wr_ack(),               
           .wr_data_count(), 
           .wr_rst_busy(),  
     
           .data_valid(fdvalid_l0),       
           .dout(fdout_l0),                   
           .rd_clk(pcie_clk),
           .rd_en(fifo_rd_l0 ),
           
           .din({rx_axis_tlast_0,rx_axis_tkeep_0,rx_axis_tdata_0}),                     
           .injectdbiterr('h0), 
           .injectsbiterr('h0), 
           .rst(rx_rst_0),    
           .sleep('h0),
           .wr_clk(rx_clk_out_0),
           .wr_en(rx_axis_tvalid_0 & (~chnl_sw_rxclk0) & wr_mode_l0) 
     
        );
        
    
      xpm_fifo_async #(
             .CDC_SYNC_STAGES(2),       // DECIMAL
             .DOUT_RESET_VALUE("0"),    // String
             .ECC_MODE("no_ecc"),       // String
             .FIFO_MEMORY_TYPE("auto"), // String
             .FIFO_READ_LATENCY(1),     // DECIMAL
             .FIFO_WRITE_DEPTH(2048),   // DECIMAL
             .FULL_RESET_VALUE(0),      // DECIMAL
             .PROG_EMPTY_THRESH(1000),    // DECIMAL
             .PROG_FULL_THRESH(1750),     // DECIMAL
             .RD_DATA_COUNT_WIDTH(1),   // DECIMAL
             .READ_DATA_WIDTH(73),      // DECIMAL 1+8+64
             .READ_MODE("fwft"),         // String
             .RELATED_CLOCKS(0),        // DECIMAL
             .USE_ADV_FEATURES("1707"), // String
             .WAKEUP_TIME(0),           // DECIMAL
             .WRITE_DATA_WIDTH(73),     // DECIMAL
             .WR_DATA_COUNT_WIDTH(1)    // DECIMAL
          )
          xpm_fifo_async_rx_l1 (
             .almost_empty(),   
             .almost_full(),     
             .dbiterr(),             
             .empty(),                 
             .full(),                   
             .overflow(),           
             .prog_empty(prog_empt_l1),       
             .prog_full(prog_full_l1),         
             .rd_data_count(), 
             .rd_rst_busy(),     
             .sbiterr(),             
             .underflow(),         
             .wr_ack(),               
             .wr_data_count(), 
             .wr_rst_busy(),  
       
             .data_valid(fdvalid_l1),       
             .dout(fdout_l1),                   
             .rd_clk(pcie_clk),
             .rd_en(fifo_rd_l1),
             
             .din({rx_axis_tlast_1,rx_axis_tkeep_1,rx_axis_tdata_1}),                     
             .injectdbiterr('h0), 
             .injectsbiterr('h0), 
             .rst(rx_rst_1),    
             .sleep('h0),
             .wr_clk(rx_clk_out_1),
             .wr_en(rx_axis_tvalid_1 & chnl_sw_rxclk1 & wr_mode_l1) 
       
          );
    /////////////////////////////////////// generates word count for each packet pushed in to rx fifo //////////////////////////      
    reg  [11:0] wordcount0;
    wire [11:0] wordcount_fout0;
    wire [11:0] wordcount_fin0;
    wire wordcount_fout_valid0;
    wire rx_count_wren0;
    
    reg [3:0] keep_bcount0;
              
    always_comb begin
      case (rx_axis_tkeep_0)
          8'h01: keep_bcount0 =  4'd1;
          8'h03: keep_bcount0 =  4'd2;
          8'h07: keep_bcount0 =  4'd3;
          8'h0f: keep_bcount0 =  4'd4;
          8'h1f: keep_bcount0 =  4'd5;
          8'h3f: keep_bcount0 =  4'd6;
          8'h7f: keep_bcount0 =  4'd7;
          8'hff: keep_bcount0 =  4'd8;
          default :  keep_bcount0 =  4'd0 ;
      endcase
    end
          
    always @(posedge rx_clk_out_0) begin
        if (rx_rst_0) begin
          wordcount0 <= 'h0;
        end
        else begin
          if(rx_axis_tvalid_0) wordcount0 <= wordcount0 + keep_bcount0;
          if(rx_axis_tlast_0 & rx_axis_tvalid_0) wordcount0 <=  8'h0;
        end
    end
              
    assign rx_count_wren0 = rx_axis_tlast_0 & rx_axis_tvalid_0 ;
    assign wordcount_fin0 = wordcount0 + keep_bcount0;
            
     xpm_fifo_async #(
        .CDC_SYNC_STAGES(2),       // DECIMAL
        .DOUT_RESET_VALUE("0"),    // String
        .ECC_MODE("no_ecc"),       // String
        .FIFO_MEMORY_TYPE("auto"), // String
        .FIFO_READ_LATENCY(1),     // DECIMAL
        .FIFO_WRITE_DEPTH(2048),   // DECIMAL
        .FULL_RESET_VALUE(0),      // DECIMAL
        .PROG_EMPTY_THRESH(10),    // DECIMAL
        .PROG_FULL_THRESH(10),     // DECIMAL
        .RD_DATA_COUNT_WIDTH(1),   // DECIMAL
        .READ_DATA_WIDTH(12),      // DECIMAL
        .READ_MODE("fwft"),         // String
        .RELATED_CLOCKS(0),        // DECIMAL
        .USE_ADV_FEATURES("1707"), // String
        .WAKEUP_TIME(0),           // DECIMAL
        .WRITE_DATA_WIDTH(12),     // DECIMAL
        .WR_DATA_COUNT_WIDTH(1)    // DECIMAL
     )
     xpm_fifo_async_inst_countl0 (
        .almost_empty(),   
        .almost_full(),     
        .dbiterr(),             
        .empty(),                 
        .full(),                   
        .overflow(),           
        .prog_empty(),       
        .prog_full(),         
        .rd_data_count(), 
        .rd_rst_busy(),     
        .sbiterr(),             
        .underflow(),         
        .wr_ack(),               
        .wr_data_count(), 
        .wr_rst_busy(),  
  
        .data_valid(wordcount_fout_valid0),       
        .dout(wordcount_fout0),                   
        .rd_clk(pcie_clk),
        .rd_en(pop_rx_count & (~chnl_sw_pclk)),
        
        .din(wordcount_fin0),                     
        .injectdbiterr('h0), 
        .injectsbiterr('h0), 
        .rst(rx_rst_0),    
        .sleep('h0),
        .wr_clk(rx_clk_out_0),
        .wr_en(rx_count_wren0 & (~chnl_sw_rxclk0) & wr_mode_l0) 
  
     );
     
     
     reg  [11:0] wordcount1;
     wire [11:0] wordcount_fout1;
     wire [11:0] wordcount_fin1;
     wire wordcount_fout_valid1;
     wire rx_count_wren1;
     
     reg [3:0] keep_bcount1;
               
     always_comb begin
       case (rx_axis_tkeep_1)
           8'h01: keep_bcount1 =  4'd1;
           8'h03: keep_bcount1 =  4'd2;
           8'h07: keep_bcount1 =  4'd3;
           8'h0f: keep_bcount1 =  4'd4;
           8'h1f: keep_bcount1 =  4'd5;
           8'h3f: keep_bcount1 =  4'd6;
           8'h7f: keep_bcount1 =  4'd7;
           8'hff: keep_bcount1 =  4'd8;
           default :  keep_bcount1 =  4'd0 ;
       endcase
     end
           
     always @(posedge rx_clk_out_1) begin
         if (rx_rst_1) begin
           wordcount1 <= 'h0;
         end
         else begin
           if(rx_axis_tvalid_1) wordcount1 <= wordcount1 + keep_bcount1;
           if(rx_axis_tlast_1 & rx_axis_tvalid_1) wordcount1 <=  8'h0;
         end
     end
               
     assign rx_count_wren1 = rx_axis_tlast_1 & rx_axis_tvalid_1;
     assign wordcount_fin1 = wordcount1 + keep_bcount1;
             
      xpm_fifo_async #(
         .CDC_SYNC_STAGES(2),       // DECIMAL
         .DOUT_RESET_VALUE("0"),    // String
         .ECC_MODE("no_ecc"),       // String
         .FIFO_MEMORY_TYPE("auto"), // String
         .FIFO_READ_LATENCY(1),     // DECIMAL
         .FIFO_WRITE_DEPTH(2048),   // DECIMAL
         .FULL_RESET_VALUE(0),      // DECIMAL
         .PROG_EMPTY_THRESH(10),    // DECIMAL
         .PROG_FULL_THRESH(10),     // DECIMAL
         .RD_DATA_COUNT_WIDTH(1),   // DECIMAL
         .READ_DATA_WIDTH(12),      // DECIMAL
         .READ_MODE("fwft"),         // String
         .RELATED_CLOCKS(0),        // DECIMAL
         .USE_ADV_FEATURES("1707"), // String
         .WAKEUP_TIME(0),           // DECIMAL
         .WRITE_DATA_WIDTH(12),     // DECIMAL
         .WR_DATA_COUNT_WIDTH(1)    // DECIMAL
      )
      xpm_fifo_async_inst_countl1 (
         .almost_empty(),   
         .almost_full(),     
         .dbiterr(),             
         .empty(),                 
         .full(),                   
         .overflow(),           
         .prog_empty(),       
         .prog_full(),         
         .rd_data_count(), 
         .rd_rst_busy(),     
         .sbiterr(),             
         .underflow(),         
         .wr_ack(),               
         .wr_data_count(), 
         .wr_rst_busy(),  
   
         .data_valid(wordcount_fout_valid1),       
         .dout(wordcount_fout1),                   
         .rd_clk(pcie_clk),
         .rd_en(pop_rx_count & chnl_sw_pclk),
         
         .din(wordcount_fin1),                     
         .injectdbiterr('h0), 
         .injectsbiterr('h0), 
         .rst(rx_rst_1),    
         .sleep('h0),
         .wr_clk(rx_clk_out_1),
         .wr_en(rx_count_wren1 & chnl_sw_rxclk1 & wr_mode_l1) 
   
      );
     
     
     assign {rx_axis_tlast,rx_axis_tkeep,rx_axis_tdata} = chnl_sw_pclk? fdout_l1 : fdout_l0;
     assign rx_axis_tvalid = chnl_sw_pclk? fdvalid_l1 : fdvalid_l0;
     assign fifo_rd_l0 = rx_axis_tready & (~chnl_sw_pclk);
     assign fifo_rd_l1 = rx_axis_tready & chnl_sw_pclk;
     
     assign rx_word_count = chnl_sw_pclk ? wordcount_fout1 : wordcount_fout0;
     assign rx_word_count_valid =  chnl_sw_pclk ? wordcount_fout_valid1 : wordcount_fout_valid0;
     
     /////////////////////////////////////////////////////////////////// TX path //////////////////////////////////////////
     wire progfull_tx_l0;
     wire fdvalid_tx_l0;
     wire [72:0] fdout_tx_l0;
     wire tx_rden_l0;
     
          xpm_fifo_async #(
             .CDC_SYNC_STAGES(2),       // DECIMAL
             .DOUT_RESET_VALUE("0"),    // String
             .ECC_MODE("no_ecc"),       // String
             .FIFO_MEMORY_TYPE("auto"), // String
             .FIFO_READ_LATENCY(1),     // DECIMAL
             .FIFO_WRITE_DEPTH(2048),   // DECIMAL
             .FULL_RESET_VALUE(0),      // DECIMAL
             .PROG_EMPTY_THRESH(1000),    // DECIMAL
             .PROG_FULL_THRESH(1750),     // DECIMAL
             .RD_DATA_COUNT_WIDTH(1),   // DECIMAL
             .READ_DATA_WIDTH(73),      // DECIMAL 1+8+64
             .READ_MODE("fwft"),         // String
             .RELATED_CLOCKS(0),        // DECIMAL
             .USE_ADV_FEATURES("1707"), // String
             .WAKEUP_TIME(0),           // DECIMAL
             .WRITE_DATA_WIDTH(73),     // DECIMAL
             .WR_DATA_COUNT_WIDTH(1)    // DECIMAL
          )
          xpm_fifo_async_tx_l0 (
             .almost_empty(),   
             .almost_full(),     
             .dbiterr(),             
             .empty(),                 
             .full(),                   
             .overflow(),           
             .prog_empty(),       
             .prog_full(progfull_tx_l0),         
             .rd_data_count(), 
             .rd_rst_busy(),     
             .sbiterr(),             
             .underflow(),         
             .wr_ack(),               
             .wr_data_count(), 
             .wr_rst_busy(),  
       
             .data_valid(fdvalid_tx_l0),       
             .dout(fdout_tx_l0),                   
             .rd_clk(tx_clk_out_0),
             .rd_en(tx_rden_l0),
             
             .din({tx_axis_tlast,tx_axis_tkeep,tx_axis_tdata}),                     
             .injectdbiterr('h0), 
             .injectsbiterr('h0), 
             .rst(pcie_rst),    
             .sleep('h0),
             .wr_clk(pcie_clk),
             .wr_en(tx_axis_tvalid & tx_axis_tready & (~chnl_sw)) 
       
          );
     assign {tx_axis_tlast_0,tx_axis_tkeep_0,tx_axis_tdata_0} = fdout_tx_l0;
     assign tx_axis_tvalid_0 = fdvalid_tx_l0;
     assign tx_axis_tuser_0 = 1'b0;
     assign tx_rden_l0 = tx_axis_tvalid_0 & tx_axis_tready_0;
     
     wire progfull_tx_l1;
     wire fdvalid_tx_l1;
     wire [72:0] fdout_tx_l1;
     wire tx_rden_l1;
     
          xpm_fifo_async #(
             .CDC_SYNC_STAGES(2),       // DECIMAL
             .DOUT_RESET_VALUE("0"),    // String
             .ECC_MODE("no_ecc"),       // String
             .FIFO_MEMORY_TYPE("auto"), // String
             .FIFO_READ_LATENCY(1),     // DECIMAL
             .FIFO_WRITE_DEPTH(2048),   // DECIMAL
             .FULL_RESET_VALUE(0),      // DECIMAL
             .PROG_EMPTY_THRESH(1000),    // DECIMAL
             .PROG_FULL_THRESH(1750),     // DECIMAL
             .RD_DATA_COUNT_WIDTH(1),   // DECIMAL
             .READ_DATA_WIDTH(73),      // DECIMAL 1+8+64
             .READ_MODE("fwft"),         // String
             .RELATED_CLOCKS(0),        // DECIMAL
             .USE_ADV_FEATURES("1707"), // String
             .WAKEUP_TIME(0),           // DECIMAL
             .WRITE_DATA_WIDTH(73),     // DECIMAL
             .WR_DATA_COUNT_WIDTH(1)    // DECIMAL
          )
          xpm_fifo_async_tx_l1 (
             .almost_empty(),   
             .almost_full(),     
             .dbiterr(),             
             .empty(),                 
             .full(),                   
             .overflow(),           
             .prog_empty(),       
             .prog_full(progfull_tx_l1),         
             .rd_data_count(), 
             .rd_rst_busy(),     
             .sbiterr(),             
             .underflow(),         
             .wr_ack(),               
             .wr_data_count(), 
             .wr_rst_busy(),  
       
             .data_valid(fdvalid_tx_l1),       
             .dout(fdout_tx_l1),                   
             .rd_clk(tx_clk_out_1),
             .rd_en(tx_rden_l1),
             
             .din({tx_axis_tlast,tx_axis_tkeep,tx_axis_tdata}),                     
             .injectdbiterr('h0), 
             .injectsbiterr('h0), 
             .rst(pcie_rst),    
             .sleep('h0),
             .wr_clk(pcie_clk),
             .wr_en(tx_axis_tvalid & tx_axis_tready & chnl_sw) 
       
          );
     assign {tx_axis_tlast_1,tx_axis_tkeep_1,tx_axis_tdata_1} = fdout_tx_l1;
     assign tx_axis_tvalid_1 = fdvalid_tx_l1;
     assign tx_axis_tuser_1 = 1'b0;
     assign tx_rden_l1 = tx_axis_tvalid_1 & tx_axis_tready_1;
     
     assign tx_axis_tready = chnl_sw? (~progfull_tx_l1) : (~progfull_tx_l0);
     

endmodule
